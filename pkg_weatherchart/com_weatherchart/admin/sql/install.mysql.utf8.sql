DROP TABLE IF EXISTS `#__weatherchart_templates`;

CREATE TABLE `#__weatherchart_templates` (
  `id` int(11) NOT NULL auto_increment,
  `name` VARCHAR(255) NOT NULL DEFAULT '',
  `file` VARCHAR(255) NOT NULL DEFAULT '',
  `timestamp` int(11) NOT NULL DEFAULT '0',
  `template` TEXT NOT NULL,
  PRIMARY KEY  (`id`),
  INDEX `idx_name` (`name`)
) ENGINE=MyISAM AUTO_INCREMENT=0 DEFAULT CHARSET=utf8;

INSERT INTO `#__weatherchart_templates` (`name`, `file`, `timestamp`, `template`) VALUES
    ('RueckblickVorhersage_OBS_FC', 'rueckvor_obs_fc', 1524659556, 'var json_data = %DATA%\r\n\r\nvar chartOptions_%CONTAINER_ID% = {\r\n  chart: {\r\n    renderTo: \'%CONTAINER_ID%\',\r\n    alignTicks: false\r\n  },\r\n  title: {\r\n    text: data_%CONTAINER_ID%.title\r\n  },\r\n  subtitle: {\r\n    text: data_%CONTAINER_ID%.subtitle\r\n  },\r\n  credits: {\r\n    enabled: true,\r\n    text: \'Zum Wochenrückblick\',\r\n    href: \'http://www.heusenstamm-wetter.de/wetter-heusenstamm/aktuelle-werte#wochenrückblick\',\r\n    position: {\r\n      align: \'center\',\r\n      x: 0,\r\n      verticalAlign: \'bottom\',\r\n      y: 0\r\n    },\r\n    style: {\r\n      cursor: \'pointer\',\r\n      color: \'#909090\',\r\n      fontSize: \'10px\'\r\n    }\r\n  },\r\n  xAxis: [{\r\n    categories: data_%CONTAINER_ID%.xaxis,\r\n    labels: {\r\n      formatter: function() {\r\n        return 	this.value == \"heute\" ? \'<p style=\"color: red; font-weight: bold; font-size: small\">heute</p>\' : getDayOfWeek(this.value);\r\n      }\r\n    }\r\n  }],\r\n  yAxis: [{ // Temperatur\r\n    allowDecimals: false,\r\n    maxPadding: 0.1,\r\n    labels: {\r\n      formatter: function() {\r\n        return this.value + data_%CONTAINER_ID%.yaxis_1_unit;\r\n      },\r\n      style: {\r\n        color: \'#000000\'\r\n      }\r\n    },\r\n    title: {\r\n      text: \'\'\r\n    }\r\n\r\n  }, { // Niederschlag\r\n    allowDecimals: false,\r\n    maxPadding: 0.1,\r\n    gridLineWidth: 0,\r\n    title: {\r\n      text: \'\'\r\n    },\r\n    labels: {\r\n      formatter: function() {\r\n        return this.value + data_%CONTAINER_ID%.yaxis_3_unit;\r\n      },\r\n      style: {\r\n        color: \'#32cd32\'\r\n      }\r\n    },\r\n    opposite: true\r\n  }],\r\n  tooltip: {\r\n    borderColor: \"#4572A7\",\r\n    borderWidth: 0,\r\n    crosshairs: {\r\n        width: 1,\r\n        color: \'black\',\r\n        dashStyle: \'solid\',\r\n        zIndex: 100\r\n    },\r\n    shared: true,\r\n    useHTML: true,\r\n    formatter: function() {\r\n      var max = this.points[1];\r\n      var min = this.points[2];\r\n      var rain = this.points[0];\r\n\r\n      day = data_%CONTAINER_ID%.xaxis_tooltip[min.point.x];\r\n      dayOfWeek = day == \'heute\' ? \'\' : getDayOfWeek(data_%CONTAINER_ID%.xaxis_tooltip[min.point.x]) + \' \';\r\n      var tooltip = \'<span style=\"font-weight:bold\">\' + dayOfWeek + data_%CONTAINER_ID%.xaxis_tooltip[min.point.x] + \"</span><br/>\";\r\n      tooltip += \'<table><tr><td style=\"border:none;color:#FF0000;font-weight:bold\">Maximum: </td><td style=\"border:none;color:#000000;font-weight:bold;text-align:right\">\' + max.y.toFixed(1) + \'&nbsp;</td><td style=\"border:none;color:#000000;font-weight:bold;text-align:left\">\' + data_%CONTAINER_ID%.yaxis_1_unit + \'</td></tr>\';\r\n      tooltip += \'<tr><td style=\"border:none;color:#0000FF;font-weight:bold\">Minimum: </td><td style=\"border:none;color:#000000;font-weight:bold;text-align:right\">\' + min.y.toFixed(1) + \'&nbsp;</td><td style=\"border:none;color:#000000;font-weight:bold;text-align:left\">\' + data_%CONTAINER_ID%.yaxis_2_unit +  \'</td></tr>\';\r\n      tooltip += \'<tr><td style=\"border:none;color:#32cd32;font-weight:bold\">Niederschlag:&nbsp;</td><td style=\"border:none;color:#000000;font-weight:bold;text-align:right\">\' + rain.y.toFixed(1) + \'&nbsp;</td><td style=\"border:none;color:#000000;font-weight:bold;text-align:left\">\' + data_%CONTAINER_ID%.yaxis_3_unit +  \'</td></tr></table>\';\r\n\r\n      return tooltip;\r\n    }\r\n  },\r\n  legend: {\r\n    layout: \'horizontal\',\r\n    align: \'center\',\r\n    verticalAlign: \'bottom\',\r\n  },\r\n  series: [{ // Precip OBS\r\n    name: data_%CONTAINER_ID%.yaxis_3_name,\r\n    color: \'#32cd32\',\r\n    type: \'column\',\r\n    grouping: false,\r\n    yAxis: 1,\r\n    legendIndex : 2,\r\n    data: data_%CONTAINER_ID%.yaxis_3\r\n  }, { // Max OBS\r\n    name: data_%CONTAINER_ID%.yaxis_1_name,\r\n    color: \'#FF0000\',\r\n    type: \'spline\',\r\n    yAxis: 0,\r\n    legendIndex : 0,\r\n    marker: { symbol: \'circle\' },\r\n    data: data_%CONTAINER_ID%.yaxis_1\r\n  }, { // Min OBS\r\n    name: data_%CONTAINER_ID%.yaxis_2_name,\r\n    type: \'spline\',\r\n    color: \'#4572A7\',\r\n    yAxis: 0,\r\n    legendIndex : 1,\r\n    marker: { symbol: \'circle\' },\r\n    data: data_%CONTAINER_ID%.yaxis_2\r\n  }, { // Precip FC\r\n    name: data_%CONTAINER_ID%.yaxis_6_name,\r\n    color: \"#C2FFB7\",\r\n    type: \'column\',\r\n    grouping: false,\r\n    yAxis: 1,\r\n    legendIndex : 5,\r\n    showInLegend: false,\r\n    data: data_%CONTAINER_ID%.yaxis_6\r\n  }, { // Max FC\r\n    name: data_%CONTAINER_ID%.yaxis_4_name,\r\n    color: \'#FF0000\',\r\n    type: \'spline\',\r\n    yAxis: 0,\r\n    legendIndex : 3,\r\n    dashStyle: \'ShortDash\',\r\n    showInLegend: false,\r\n    marker: { enabled: false },\r\n    data: data_%CONTAINER_ID%.yaxis_4\r\n  }, { // Min FC\r\n    name: data_%CONTAINER_ID%.yaxis_5_name,\r\n    type: \'spline\',\r\n    color: \'#4572A7\',\r\n    yAxis: 0,\r\n    legendIndex : 4,\r\n    dashStyle: \'ShortDash\',\r\n    showInLegend: false,\r\n    marker: { enabled: false },\r\n    data: data_%CONTAINER_ID%.yaxis_5\r\n  }],\r\n  plotOptions: {\r\n    series: {\r\n      events: {\r\n        legendItemClick: function(event) {\r\n          return false;\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\njqChart_%CONTAINER_ID% = jQuery.noConflict();\r\nfunction loadChart_%CONTAINER_ID%() {\r\n  new Highcharts.Chart(chartOptions_%CONTAINER_ID%);\r\n}\r\njqChart_%CONTAINER_ID%(document).ready(function() {\r\n  loadChart_%CONTAINER_ID%();\r\n});\r\n\r\nfunction getDayOfWeek(dateAsString) {\r\n  weekDays = new Array(\"So\", \"Mo\", \"Di\", \"Mi\", \"Do\", \"Fr\", \"Sa\");\r\n  year = dateAsString.slice(6, 10);\r\n  month = dateAsString.slice(3, 5) - 1;\r\n  day = dateAsString.slice(0, 2);\r\n  date = new Date(year, month, day);\r\n  dayOfWeek = date.getDay();\r\n  return weekDays[dayOfWeek];\r\n}\r\n');
